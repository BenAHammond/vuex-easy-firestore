{"version":3,"file":"index.js","sources":["../node_modules/deepmerge/dist/es.js","../src/utils/overwriteMerge.js","../src/module/defaultConfig.js","../src/module/state.js","../src/module/mutations.js","../src/utils/copyObj.js","../src/utils/setDefaultValues.js","../src/utils/debounceHelper.js","../src/module/actions.js","../src/utils/checkFillables.js","../src/module/getters.js","../src/module/errorCheck.js","../src/module/index.js","../src/index.js"],"sourcesContent":["var isMergeableObject = function isMergeableObject(value) {\n\treturn isNonNullObject(value)\n\t\t&& !isSpecial(value)\n};\n\nfunction isNonNullObject(value) {\n\treturn !!value && typeof value === 'object'\n}\n\nfunction isSpecial(value) {\n\tvar stringValue = Object.prototype.toString.call(value);\n\n\treturn stringValue === '[object RegExp]'\n\t\t|| stringValue === '[object Date]'\n\t\t|| isReactElement(value)\n}\n\n// see https://github.com/facebook/react/blob/b5ac963fb791d1298e7f396236383bc955f916c1/src/isomorphic/classic/element/ReactElement.js#L21-L25\nvar canUseSymbol = typeof Symbol === 'function' && Symbol.for;\nvar REACT_ELEMENT_TYPE = canUseSymbol ? Symbol.for('react.element') : 0xeac7;\n\nfunction isReactElement(value) {\n\treturn value.$$typeof === REACT_ELEMENT_TYPE\n}\n\nfunction emptyTarget(val) {\n\treturn Array.isArray(val) ? [] : {}\n}\n\nfunction cloneUnlessOtherwiseSpecified(value, options) {\n\treturn (options.clone !== false && options.isMergeableObject(value))\n\t\t? deepmerge(emptyTarget(value), value, options)\n\t\t: value\n}\n\nfunction defaultArrayMerge(target, source, options) {\n\treturn target.concat(source).map(function(element) {\n\t\treturn cloneUnlessOtherwiseSpecified(element, options)\n\t})\n}\n\nfunction mergeObject(target, source, options) {\n\tvar destination = {};\n\tif (options.isMergeableObject(target)) {\n\t\tObject.keys(target).forEach(function(key) {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(target[key], options);\n\t\t});\n\t}\n\tObject.keys(source).forEach(function(key) {\n\t\tif (!options.isMergeableObject(source[key]) || !target[key]) {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(source[key], options);\n\t\t} else {\n\t\t\tdestination[key] = deepmerge(target[key], source[key], options);\n\t\t}\n\t});\n\treturn destination\n}\n\nfunction deepmerge(target, source, options) {\n\toptions = options || {};\n\toptions.arrayMerge = options.arrayMerge || defaultArrayMerge;\n\toptions.isMergeableObject = options.isMergeableObject || isMergeableObject;\n\n\tvar sourceIsArray = Array.isArray(source);\n\tvar targetIsArray = Array.isArray(target);\n\tvar sourceAndTargetTypesMatch = sourceIsArray === targetIsArray;\n\n\tif (!sourceAndTargetTypesMatch) {\n\t\treturn cloneUnlessOtherwiseSpecified(source, options)\n\t} else if (sourceIsArray) {\n\t\treturn options.arrayMerge(target, source, options)\n\t} else {\n\t\treturn mergeObject(target, source, options)\n\t}\n}\n\ndeepmerge.all = function deepmergeAll(array, options) {\n\tif (!Array.isArray(array)) {\n\t\tthrow new Error('first argument should be an array')\n\t}\n\n\treturn array.reduce(function(prev, next) {\n\t\treturn deepmerge(prev, next, options)\n\t}, {})\n};\n\nvar deepmerge_1 = deepmerge;\n\nexport default deepmerge_1;\n","\n/**\n * Makes sure to overwrite arrays completely instead of concatenating with a merge(). Usage: merge(arr1, arr2, {arrayMerge: overwriteMerge})\n *\n * @export\n * @returns the latter array passed\n */\nexport default function (destinationArray, sourceArray, options) {\n  return sourceArray\n}\n","\n/**\n * A function executed during the 2 way sync when docs are added/modified/deleted. NEEDS TO EXECUTE FIRST PARAM! You can use this function to do a conditional check on the documents to decide if/when to execute the store update.\n *\n * @param {function} storeUpdateFn this is the function that will make changes to your vuex store. Takes no params.\n * @param {object} store the store for usage with `store.dispatch`, `store.commit`, `store.getters` etc.\n * @param {string} id the doc id returned in `change.doc.id` (see firestore documentation for more info)\n * @param {object} doc the doc returned in `change.doc.data()` (see firestore documentation for more info)\n * @param {string} source of the change. Can be 'local' or 'server'\n */\nfunction syncHook (storeUpdateFn, store, id, doc, source, change) {\n  // throw error if you want to stop the document in your store from being modified\n  // do some stuff\n  storeUpdateFn()\n  // do some stuff\n}\n\nexport default {\n  moduleNameSpace: 'firestore',\n  // this is the vuex module path that will be created\n  docsStateProp: '',\n  // this is the state property where your docs will end up inside the module\n  // when not set your doc's props will be set directly to your vuex module's state\n  firestorePath: '',\n  // this is the firestore collection path to your documents. You can use `{userId}` which will be replaced with `Firebase.auth().uid`\n  firestoreRefType: 'collection', // or 'doc'\n  // depending if what you want to sync is a whole collection or a single doc\n  vuexUserPath: '',\n  // the path where your firebase user gets saved in vuex. Required to be able to have reactivity after login.\n  sync: {\n    type: '2way',\n    // '2way' only ('read only' not yet integrated)\n    where: [], // only applicable on 'collection'\n    orderBy: [], // only applicable on 'collection'\n    defaultValues: {},\n    // About defaultValues:\n    // These are the default properties that will be set on each doc that's synced to the store or comes out of the store.\n    // You HAVE to set all props you want to be reactive on beforehand!\n    // These values are only set when you have items who don't have the props defined in defaultValues upon retrieval\n    // The retrieved document will be deep merged on top of these default values\n    added: syncHook,\n    modified: syncHook,\n    removed: syncHook,\n    // see the syncHook function above to see what you can do\n    // for firestoreRefType: 'doc' only use 'modified' syncHook\n  },\n  fetch: {\n    docLimit: 50, // defaults to 50\n  },\n  insert: {\n    checkCondition: null,\n    // A function where you can check something and force stopping the operation if you return `false`\n    // Eg. checkCondition (doc, docs) { return (doc.something != 'something') },\n    fillables: [],\n    guard: [],\n  },\n  patch: {\n    checkCondition: null,\n    // A function where you can check something and force stopping the operation if you return `false`\n    // Eg. checkCondition (id, fields, docs) { return (doc.something != 'something') },\n    fillables: [],\n    guard: [],\n  },\n  delete: {\n    checkCondition: null,\n    // A function where you can check something and force stopping the operation if you return `false`\n    // Eg. checkCondition (id, docs) { return (doc.something != 'something') },\n  }\n}\n","\nexport default {\n  // user: null,\n  syncStack: {\n    updates: {},\n    deletions: [],\n    inserts: [],\n    debounceTimer: null\n  },\n  retrievedFetchRefs: [],\n  nextFetchRef: null,\n  patching: false,\n  doneFetching: false,\n  stopPatchingTimeout: null,\n}\n","import { defaultMutations } from 'vuex-easy-access'\nimport { isObject } from 'is-what'\nimport merge from '../../node_modules/deepmerge/dist/es.js'\nimport overwriteMerge from '../utils/overwriteMerge'\n\nconst mutations = {\n  resetSyncStack (state) {\n    state.syncStack = {\n      updates: {},\n      deletions: [],\n      inserts: [],\n      debounceTimer: null\n    }\n  },\n  INSERT_DOC (state, doc) {\n    if (state.firestoreRefType.toLowerCase() === 'doc') return\n    this._vm.$set(state[state.docsStateProp], doc.id, doc)\n  },\n  PATCH_DOC (state, doc) {\n    if (state.firestoreRefType.toLowerCase() === 'doc') {\n      if (!state.docsStateProp) {\n        return Object.keys(doc).forEach(key => {\n          // Merge if exists\n          const newVal = (state[key] === undefined)\n            ? doc[key]\n            : (!isObject(state[key]) || !isObject(doc[key]))\n              ? doc[key]\n              : merge(state[key], doc[key], {arrayMerge: overwriteMerge})\n          this._vm.$set(state, key, newVal)\n        })\n      }\n      // state[state.docsStateProp] will always be an empty object by default\n      state[state.docsStateProp] = merge(\n        state[state.docsStateProp],\n        doc,\n        {arrayMerge: overwriteMerge}\n      )\n      return\n    }\n    // Merge if exists\n    const newVal = (state[state.docsStateProp][doc.id] === undefined)\n      ? doc\n      : (!isObject(state[state.docsStateProp][doc.id]) || !isObject(doc))\n        ? doc\n        : merge(state[state.docsStateProp][doc.id], doc, {arrayMerge: overwriteMerge})\n    this._vm.$set(state[state.docsStateProp], doc.id, newVal)\n  },\n  DELETE_DOC (state, id) {\n    if (state.firestoreRefType.toLowerCase() === 'doc') return\n    this._vm.$delete(state[state.docsStateProp], id)\n  }\n}\n\nexport default function (userMutations = {}, state) {\n  const vuexEasyMutations = defaultMutations(state)\n  return Object.assign({}, vuexEasyMutations, mutations, userMutations)\n}\n","/**\n * copyObj helper\n *\n * @author     Adam Dorling\n * @contact    https://codepen.io/naito\n */\nexport default function copyObj (obj) {\n  let newObj\n  if (typeof obj != 'object') {\n    return obj\n  }\n  if (!obj) {\n    return obj\n  }\n  if ('[object Object]' !== Object.prototype.toString.call(obj) ||\n    '[object Array]' !== Object.prototype.toString.call(obj)\n  ) {\n    return JSON.parse(JSON.stringify(obj))\n  }\n  // Object is an Array\n  if ('[object Array]' === Object.prototype.toString.call(obj)) {\n    newObj = []\n    for (let i = 0, len = obj.length; i < len; i++) {\n      newObj[i] = copyObj(obj[i])\n    }\n    return newObj\n  }\n  // Object is an Object\n  newObj = {}\n  for (let i in obj) {\n    if (obj.hasOwnProperty(i)) {\n      newObj[i] = copyObj(obj[i])\n    }\n  }\n  return newObj\n}\n","import merge from '../../node_modules/deepmerge/dist/es.js'\nimport overwriteMerge from './overwriteMerge'\n\n/**\n * Sets default values on an object\n *\n * @param {object} obj on which to set the default values\n * @param {object} defaultValues the default values\n */\nexport default function (obj, defaultValues) {\n  return merge(defaultValues, obj, {arrayMerge: overwriteMerge})\n}\n","/**\n * debounce helper\n *\n * @author     Adam Dorling\n * @contact    https://codepen.io/naito\n */\n\n// USAGE:\n// let d = startDebounce(1000)\n// d.done.then(_ => handle())\n// d.refresh() // to refresh\n\nexport default function (ms) {\n  let startTime = Date.now()\n  const done = new Promise((resolve, reject) => {\n    const interval = setInterval(_ => {\n      const now = Date.now()\n      const deltaT = now - startTime\n      if (deltaT >= ms) {\n        clearInterval(interval)\n        resolve(true)\n      }\n    }, 10)\n  })\n  const refresh = () => (startTime = Date.now())\n  return { done, refresh }\n}\n","import Firebase from 'firebase/app'\nimport 'firebase/firestore'\nimport { isArray, isString } from 'is-what'\nimport merge from '../../node_modules/deepmerge/dist/es.js'\nimport copyObj from '../utils/copyObj'\nimport overwriteMerge from '../utils/overwriteMerge'\nimport setDefaultValues from '../utils/setDefaultValues'\nimport startDebounce from '../utils/debounceHelper'\n\nconst actions = {\n  patchDoc (\n    {state, getters, commit, dispatch},\n    {id = '', ids = [], field = '', fields = []} = {ids: [], fields: []}\n  ) {\n    // 0. payload correction (only arrays)\n    if (!isArray(ids) || !isArray(fields)) return console.log('ids, fields need to be arrays')\n    if (!isString(field)) return console.log('field needs to be a string')\n    if (id) ids.push(id)\n    if (field) fields.push(field)\n\n    // 1. Prepare for patching\n    let syncStackItems = getters.prepareForPatch(ids, fields)\n\n    // 2. Push to syncStack\n    Object.keys(syncStackItems).forEach(id => {\n      const newVal = (!state.syncStack.updates[id])\n        ? syncStackItems[id]\n        : merge(\n            state.syncStack.updates[id],\n            syncStackItems[id],\n            {arrayMerge: overwriteMerge}\n          )\n      state.syncStack.updates[id] = newVal\n    })\n\n    // 3. Create or refresh debounce\n    return dispatch('handleSyncStackDebounce')\n  },\n  deleteDoc ({state, getters, commit, dispatch},\n  ids = []) {\n    // 0. payload correction (only arrays)\n    if (!isArray(ids)) ids = [ids]\n\n    // 1. Prepare for patching\n    const syncStackIds = getters.prepareForDeletion(ids)\n\n    // 2. Push to syncStack\n    const deletions = state.syncStack.deletions.concat(syncStackIds)\n    commit('SET_SYNCSTACK.DELETIONS', deletions)\n\n    if (!state.syncStack.deletions.length) return\n    // 3. Create or refresh debounce\n    return dispatch('handleSyncStackDebounce')\n  },\n  insertDoc ({state, getters, commit, dispatch},\n  docs = []) {\n    // 0. payload correction (only arrays)\n    if (!isArray(docs)) docs = [docs]\n\n    // 1. Prepare for patching\n    const syncStack = getters.prepareForInsert(docs)\n\n    // 2. Push to syncStack\n    const inserts = state.syncStack.inserts.concat(syncStack)\n    commit('SET_SYNCSTACK.INSERTS', inserts)\n\n    // 3. Create or refresh debounce\n    return dispatch('handleSyncStackDebounce')\n  },\n  handleSyncStackDebounce ({state, commit, dispatch, getters}) {\n    if (!getters.signedIn) return false\n    if (!state.syncStack.debounceTimer) {\n      const debounceTimer = startDebounce(1000)\n      debounceTimer.done.then(_ => dispatch('batchSync'))\n      commit('SET_SYNCSTACK.DEBOUNCETIMER', debounceTimer)\n    }\n    state.syncStack.debounceTimer.refresh()\n  },\n  async batchSync ({getters, commit, dispatch, state}) {\n    const collectionMode = getters.collectionMode\n    const dbRef = getters.dbRef\n    let batch = Firebase.firestore().batch()\n    let count = 0\n    // Add 'updateds' to batch\n    let updatesOriginal = copyObj(state.syncStack.updates)\n    let updates = Object.keys(updatesOriginal).map(k => {\n      let fields = updatesOriginal[k]\n      return {id: k, fields}\n    })\n    // Check if there are more than 500 batch items already\n    if (updates.length >= 500) {\n      // Batch supports only until 500 items\n      count = 500\n      let updatesOK = updates.slice(0, 500)\n      let updatesLeft = updates.slice(500, -1)\n      // Put back the remaining items over 500\n      state.syncStack.updates = updatesLeft.reduce((carry, item) => {\n        carry[item.id] = item\n        delete item.id\n        return carry\n      }, {})\n      updates = updatesOK\n    } else {\n      state.syncStack.updates = {}\n      count = updates.length\n    }\n    // Add to batch\n    updates.forEach(item => {\n      let id = item.id\n      let docRef = (collectionMode) ? dbRef.doc(id) : dbRef\n      let fields = item.fields\n      batch.update(docRef, fields)\n    })\n    // Add 'deletions' to batch\n    let deletions = copyObj(state.syncStack.deletions)\n    // Check if there are more than 500 batch items already\n    if (count >= 500) {\n      // already at 500 or more, leave items in syncstack, and don't add anything to batch\n      deletions = []\n    } else {\n      // Batch supports only until 500 items\n      let deletionsAmount = 500 - count\n      let deletionsOK = deletions.slice(0, deletionsAmount)\n      let deletionsLeft = deletions.slice(deletionsAmount, -1)\n      // Put back the remaining items over 500\n      commit('SET_SYNCSTACK.DELETIONS', deletionsLeft)\n      count = count + deletionsOK.length\n      // Define the items we'll add below\n      deletions = deletionsOK\n    }\n    // Add to batch\n    deletions.forEach(id => {\n      let docRef = dbRef.doc(id)\n      batch.delete(docRef)\n    })\n    // Add 'inserts' to batch\n    let inserts = copyObj(state.syncStack.inserts)\n    // Check if there are more than 500 batch items already\n    if (count >= 500) {\n      // already at 500 or more, leave items in syncstack, and don't add anything to batch\n      inserts = []\n    } else {\n      // Batch supports only until 500 items\n      let insertsAmount = 500 - count\n      let insertsOK = inserts.slice(0, insertsAmount)\n      let insertsLeft = inserts.slice(insertsAmount, -1)\n      // Put back the remaining items over 500\n      commit('SET_SYNCSTACK.INSERTS', insertsLeft)\n      count = count + insertsOK.length\n      // Define the items we'll add below\n      inserts = insertsOK\n    }\n    // Add to batch\n    inserts.forEach(item => {\n      let newRef = getters.dbRef.doc(item.id)\n      batch.set(newRef, item)\n    })\n    // Commit the batch:\n    // console.log(`[batchSync] START:\n    //   ${Object.keys(updates).length} updates,\n    //   ${deletions.length} deletions,\n    //   ${inserts.length} inserts`\n    // )\n    dispatch('_startPatching')\n    commit('SET_SYNCSTACK.DEBOUNCETIMER', null)\n    await batch.commit()\n    .then(res => {\n      console.log(`[batchSync] RESOLVED:`, res, `\n        updates: `, Object.keys(updates).length ? updates : {}, `\n        deletions: `, deletions.length ? deletions : [], `\n        inserts: `, inserts.length ? inserts : []\n      )\n      let remainingSyncStack = Object.keys(state.syncStack.updates).length\n        + state.syncStack.deletions.length\n        + state.syncStack.inserts.length\n      if (remainingSyncStack) { dispatch('batchSync') }\n      dispatch('_stopPatching')\n\n      // // Fetch the item if it was added as an Archived item:\n      // if (item.archived) {\n        //   get_ters.dbRef.doc(res.id).get()\n        //   .then(doc => {\n          //     let tempId = doc.data().id\n          //     let id = doc.id\n          //     let item = doc.data()\n          //     item.id = id\n          //     console.log('retrieved Archived new item: ', id, item)\n          //     dispatch('newItemFromServer', {item, tempId})\n          //   })\n          // }\n    }).catch(error => {\n      commit('SET_PATCHING', 'error')\n      commit('SET_SYNCSTACK.DEBOUNCETIMER', null)\n      throw error\n    })\n  },\n  fetch (\n    {state, getters, commit},\n    {whereFilters = [], orderBy = []} = {whereFilters: [], orderBy: []}\n    // whereFilters: [['archived', '==', true]]\n    // orderBy: ['done_date', 'desc']\n  ) {\n    return new Promise((resolve, reject) => {\n      console.log('[fetch] starting')\n      if (!getters.signedIn) return resolve()\n      if (state.doneFetching) {\n        console.log('done fetching')\n        return resolve('fetchedAll')\n      }\n      // attach fetch filters\n      let fetchRef\n      if (state.nextFetchRef) {\n        // get next ref if saved in state\n        fetchRef = state.nextFetchRef\n      } else {\n        // apply where filters and orderBy\n        fetchRef = getters.dbRef\n        whereFilters.forEach(paramsArr => {\n          fetchRef = fetchRef.where(...paramsArr)\n        })\n        if (orderBy.length) {\n          fetchRef = fetchRef.orderBy(...orderBy)\n        }\n      }\n      fetchRef = fetchRef.limit(state.fetch.docLimit)\n      // Stop if all records already fetched\n      if (state.retrievedFetchRefs.includes(fetchRef)) {\n        console.log('Already retrieved this part.')\n        return resolve()\n      }\n      // make fetch request\n      fetchRef.get()\n      .then(querySnapshot => {\n        const docs = querySnapshot.docs\n        if (docs.length === 0) {\n          commit('SET_DONEFETCHING', true)\n          return resolve('fetchedAll')\n        }\n        if (docs.length < state.fetch.docLimit) {\n          commit('SET_DONEFETCHING', true)\n        }\n        commit('PUSH_RETRIEVEDFETCHREFS', fetchRef)\n        // Get the last visible document\n        resolve(querySnapshot)\n        const lastVisible = docs[docs.length - 1]\n        // get the next records.\n        const next = fetchRef.startAfter(lastVisible)\n        commit('SET_NEXTFETCHREF', next)\n      }).catch(error => {\n        console.log(error)\n        return reject(error)\n      })\n    })\n  },\n  serverUpdate ({commit}, {change, id, doc = {}}) {\n    doc.id = id\n    switch (change) {\n      case 'added':\n        commit('INSERT_DOC', doc)\n        break\n      case 'removed':\n        commit('DELETE_DOC', id)\n        break\n      default:\n        commit('PATCH_DOC', doc)\n        break\n    }\n  },\n  openDBChannel ({getters, state, commit, dispatch}) {\n    const collectionMode = getters.collectionMode\n    let dbRef = getters.dbRef\n    // apply where filters and orderBy\n    if (state.firestoreRefType.toLowerCase() !== 'doc') {\n      state.sync.where.forEach(paramsArr => {\n        dbRef = dbRef.where(...paramsArr)\n      })\n      if (state.sync.orderBy.length) {\n        dbRef = dbRef.orderBy(...state.sync.orderBy)\n      }\n    }\n    // define handleDoc()\n    function handleDoc (change, id, doc, source) {\n      change = (!change) ? 'modified' : change.type\n      // define storeUpdateFn()\n      function storeUpdateFn () {\n        return dispatch('serverUpdate', {change, id, doc})\n      }\n      // get user set sync hook function\n      const syncHookFn = state.sync[change]\n      if (syncHookFn) {\n        syncHookFn(storeUpdateFn, this, id, doc, source)\n      } else {\n        storeUpdateFn()\n      }\n    }\n    // make a promise\n    return new Promise ((resolve, reject) => {\n      dbRef\n      .onSnapshot(querySnapshot => {\n        let source = querySnapshot.metadata.hasPendingWrites ? 'local' : 'server'\n        if (!collectionMode) {\n          const doc = setDefaultValues(querySnapshot.data(), state.sync.defaultValues)\n          if (source === 'local') return resolve()\n          handleDoc(null, null, doc, source)\n          return resolve()\n        }\n        querySnapshot.docChanges().forEach(change => {\n          // Don't do anything for local modifications & removals\n          if (source === 'local' &&\n            (change.type === 'modified' || change.type === 'removed')\n          ) {\n            return resolve()\n          }\n          const id = change.doc.id\n          const doc = (change.type === 'added')\n            ? setDefaultValues(change.doc.data(), state.sync.defaultValues)\n            : change.doc.data()\n          handleDoc(change, id, doc, source)\n          return resolve()\n        })\n      }, error => {\n        commit('SET_PATCHING', 'error')\n        return reject(error)\n      })\n    })\n  },\n  set ({commit, dispatch, getters, state}, doc) {\n    if (!doc) return\n    if (!getters.collectionMode) {\n      return dispatch('patch', doc)\n    }\n    if (!doc.id || !state[state.docsStateProp][doc.id]) {\n      return dispatch('insert', doc)\n    }\n    return dispatch('patch', doc)\n  },\n  insert ({commit, dispatch, getters}, doc) {\n    if (!doc) return\n    if (!doc.id) doc.id = getters.dbRef.doc().id\n    commit('INSERT_DOC', doc)\n    return dispatch('insertDoc', doc)\n  },\n  patch ({commit, state, dispatch, getters}, doc) {\n    if (!doc) return\n    if (!doc.id && getters.collectionMode) return\n    commit('PATCH_DOC', doc)\n    return dispatch('patchDoc', {id: doc.id, fields: Object.keys(doc)})\n  },\n  delete ({commit, dispatch, getters}, id) {\n    commit('DELETE_DOC', id)\n    return dispatch('deleteDoc', id)\n  },\n  _stopPatching ({state, commit}) {\n    if (state.stopPatchingTimeout) { clearTimeout(state.stopPatchingTimeout) }\n    state.stopPatchingTimeout = setTimeout(_ => { commit('SET_PATCHING', false) }, 300)\n  },\n  _startPatching ({state, commit}) {\n    if (state.stopPatchingTimeout) { clearTimeout(state.stopPatchingTimeout) }\n    commit('SET_PATCHING', true)\n  }\n}\n\nexport default function (userActions = {}) {\n  return Object.assign({}, actions, userActions)\n}\n","\nimport { isObject } from 'is-what'\n/**\n * Checks all props of an object and deletes guarded and non-fillables.\n *\n * @param {object}  obj       the target object to check\n * @param {array}   fillables an array of strings, with the props which should be allowed on returned object\n * @param {array}   guard     an array of strings, with the props which should NOT be allowed on returned object\n *\n * @returns {object} the cleaned object after deleting guard and non-fillables\n */\nexport default function (obj, fillables = [], guard = []) {\n  if (!isObject(obj)) return obj\n  if (fillables.length) {\n    Object.keys(obj).forEach(key => {\n      if (!fillables.includes(key)) {\n        delete obj[key]\n      }\n    })\n  }\n  guard.forEach(key => {\n    delete obj[key]\n  })\n  return obj\n}\n","import Firebase from 'firebase/app'\nimport 'firebase/firestore'\nimport 'firebase/auth'\nimport copyObj from '../utils/copyObj'\nimport { getDeepRef } from 'vuex-easy-access'\nimport checkFillables from '../utils/checkFillables'\n\nconst getters = {\n  signedIn: (state, getters, rootState, rootGetters) => {\n    const user = getDeepRef(rootState, state.vuexUserPath)\n    return (user !== null)\n  },\n  dbRef: (state, getters, rootState, rootGetters) => {\n    if (!getters.signedIn) return false\n    const userId = Firebase.auth().currentUser.uid\n    const path = state.firestorePath.replace('{userId}', userId)\n    return (state.firestoreRefType.toLowerCase() === 'collection')\n      ? Firebase.firestore().collection(path)\n      : Firebase.firestore().doc(path)\n  },\n  storeRef: (state, getters, rootState) => {\n    const path = (state.docsStateProp)\n      ? `${state.moduleNameSpace}/${state.docsStateProp}`\n      : state.moduleNameSpace\n    return getDeepRef(rootState, path)\n  },\n  collectionMode: (state, getters, rootState) => {\n    return (state.firestoreRefType.toLowerCase() === 'collection')\n  },\n  prepareForPatch: (state, getters, rootState, rootGetters) =>\n  (ids = [], fields = []) => {\n    // get relevant data from the storeRef\n    const collectionMode = getters.collectionMode\n    if (!collectionMode) ids.push('singleDoc')\n    // returns {object} -> {id: data}\n    return ids.reduce((carry, id) => {\n      // Accept an extra condition to check\n      const check = state.patch.checkCondition\n      if (check && !check(id, fields, getters.storeRef)) return carry\n\n      let patchData = {}\n      // Patch specific fields only\n      if (fields.length) {\n        fields.forEach(field => {\n          patchData[field] = (collectionMode)\n            ? getters.storeRef[id][field]\n            : getters.storeRef[field]\n        })\n      // Patch the whole item\n      } else {\n        patchData = (collectionMode)\n          ? copyObj(getters.storeRef[id])\n          : copyObj(getters.storeRef)\n        patchData = checkFillables(patchData, state.patch.fillables, state.patch.guard)\n      }\n      patchData.updated_at = Firebase.firestore.FieldValue.serverTimestamp()\n      carry[id] = patchData\n      return carry\n    }, {})\n  },\n  prepareForDeletion: (state, getters, rootState, rootGetters) =>\n  (ids = []) => {\n    return ids.reduce((carry, id) => {\n      // Accept an extra condition to check\n      let check = state.delete.checkCondition\n      if (check && !check(id, getters.storeRef)) return carry\n      carry.push(id)\n      return carry\n    }, [])\n  },\n  prepareForInsert: (state, getters, rootState, rootGetters) =>\n  (items = []) => {\n    items = copyObj(items)\n    return items.reduce((carry, item) => {\n      // Accept an extra condition to check\n      let check = state.insert.checkCondition\n      if (check && !check(item, getters.storeRef)) return carry\n\n      item = checkFillables(item, state.insert.fillables, state.insert.guard)\n      item.created_at = Firebase.firestore.FieldValue.serverTimestamp()\n      item.created_by = rootGetters['user/id']\n      carry.push(item)\n      return carry\n    }, [])\n  }\n}\n\nexport default function (userGetters = {}) {\n  return Object.assign({}, getters, userGetters)\n}\n","\nexport default function errorCheck (config) {\n  let reqProps = ['firestorePath', 'vuexUserPath']\n  reqProps.forEach(prop => {\n    console.error(`Missing ${prop} from your config!`)\n    return false\n  })\n  if (/(\\.|\\/)/.test(config.docsStateProp)) {\n    console.error(`docsStateProp must only include letters from [a-z]`)\n    return false\n  }\n  if (/\\./.test(config.moduleNameSpace)) {\n    console.error(`moduleNameSpace must only include letters from [a-z] and forward slashes '/'`)\n    return false\n  }\n  return true\n}\n","// import merge from 'deepmerge'\nimport merge from '../../node_modules/deepmerge/dist/es.js'\nimport overwriteMerge from '../utils/overwriteMerge'\n// store\nimport defaultConfig from './defaultConfig'\nimport initialState from './state'\nimport iniMutations from './mutations'\nimport iniActions from './actions'\nimport iniGetters from './getters'\nimport errorCheck from './errorCheck'\n\nconst vuexBase = {state: null, mutations: null, actions: null, getters: null}\n\n/**\n * A function that returns a vuex module object with seamless 2-way sync for firestore.\n *\n * @param {object} userConfig Takes a config object as per ...\n * @returns {object} the module ready to be included in your vuex store\n */\nexport default function (userConfig) {\n  const conf = merge(vuexBase, userConfig, {arrayMerge: overwriteMerge})\n  if (!errorCheck(conf)) return\n  const userState = conf.state\n  const userMutations = conf.mutations\n  const userActions = conf.actions\n  const userGetters = conf.getters\n  delete conf.state\n  delete conf.mutations\n  delete conf.actions\n  delete conf.getters\n\n  const docContainer = {}\n  if (conf.docsStateProp) docContainer[conf.docsStateProp] = {}\n  const state = merge.all([initialState, defaultConfig, userState, conf, docContainer], {arrayMerge: overwriteMerge})\n\n  return {\n    namespaced: true,\n    state,\n    mutations: iniMutations(userMutations, merge(initialState, userState)),\n    actions: iniActions(userActions),\n    getters: iniGetters(userGetters)\n  }\n}\n","import Firebase from 'firebase/app'\nimport 'firebase/auth'\nimport { getKeysFromPath } from 'vuex-easy-access'\nimport { isArray } from 'is-what'\nimport iniModule from './module/index'\nimport 'regenerator-runtime/runtime'\n\nexport default function createEasyFirestore (userConfig) {\n  return store => {\n    // Get an array of config files\n    if (!isArray(userConfig)) userConfig = [userConfig]\n    // Create a module for each config file\n    userConfig.forEach(config => {\n      const moduleNameSpace = getKeysFromPath(config.moduleNameSpace)\n      store.registerModule(moduleNameSpace, iniModule(config))\n    })\n    store.setDoc = (path, payload) => {\n      return store.dispatch(path + '/setDoc', payload)\n    }\n    store.insert = (path, payload) => {\n      return store.dispatch(path + '/insert', payload)\n    }\n    store.patch = (path, payload) => {\n      return store.dispatch(path + '/patch', payload)\n    }\n    store.delete = (path, payload) => {\n      return store.dispatch(path + '/delete', payload)\n    }\n  }\n}\n"],"names":["destinationArray","sourceArray","options","syncHook","storeUpdateFn","store","id","doc","source","change","moduleNameSpace","docsStateProp","firestorePath","firestoreRefType","vuexUserPath","sync","type","where","orderBy","defaultValues","added","modified","removed","fetch","docLimit","insert","checkCondition","fillables","guard","patch","delete","syncStack","updates","deletions","inserts","debounceTimer","retrievedFetchRefs","nextFetchRef","patching","doneFetching","stopPatchingTimeout","mutations","resetSyncStack","state","INSERT_DOC","toLowerCase","_vm","$set","PATCH_DOC","Object","keys","forEach","newVal","key","undefined","isObject","merge","arrayMerge","overwriteMerge","DELETE_DOC","$delete","userMutations","vuexEasyMutations","defaultMutations","assign","copyObj","obj","newObj","prototype","toString","call","JSON","parse","stringify","i","len","length","hasOwnProperty","ms","startTime","Date","now","done","Promise","resolve","reject","interval","setInterval","deltaT","clearInterval","refresh","actions","patchDoc","getters","commit","dispatch","ids","fields","field","isArray","console","log","isString","push","syncStackItems","prepareForPatch","deleteDoc","syncStackIds","prepareForDeletion","concat","insertDoc","docs","prepareForInsert","handleSyncStackDebounce","signedIn","startDebounce","then","batchSync","collectionMode","dbRef","batch","Firebase","firestore","count","updatesOriginal","map","k","updatesOK","slice","updatesLeft","reduce","carry","item","docRef","update","deletionsAmount","deletionsOK","deletionsLeft","insertsAmount","insertsOK","insertsLeft","newRef","set","res","remainingSyncStack","catch","error","whereFilters","fetchRef","paramsArr","limit","includes","get","querySnapshot","lastVisible","next","startAfter","serverUpdate","openDBChannel","handleDoc","syncHookFn","onSnapshot","metadata","hasPendingWrites","setDefaultValues","data","docChanges","_stopPatching","clearTimeout","setTimeout","_startPatching","userActions","rootState","rootGetters","user","getDeepRef","userId","auth","currentUser","uid","path","replace","collection","storeRef","check","patchData","checkFillables","updated_at","FieldValue","serverTimestamp","items","created_at","created_by","userGetters","errorCheck","config","reqProps","prop","test","vuexBase","userConfig","conf","userState","docContainer","all","initialState","defaultConfig","namespaced","iniMutations","iniActions","iniGetters","createEasyFirestore","getKeysFromPath","registerModule","iniModule","setDoc","payload"],"mappings":"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"}