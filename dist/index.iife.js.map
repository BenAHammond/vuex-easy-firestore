{"version":3,"file":"index.iife.js","sources":["../src/utils/nanomerge.js","../src/utils/deepmerge.js","../src/module/defaultConfig.js","../src/module/state.js","../src/module/mutations.js","../src/utils/copyObj.js","../src/utils/setDefaultValues.js","../src/utils/debounceHelper.js","../src/utils/objectFlattenToPaths.js","../src/module/actions.js","../src/utils/checkFillables.js","../src/module/getters.js","../src/module/errorCheck.js","../src/module/index.js","../src/index.js"],"sourcesContent":["var nanoclone = require('nanoclone').default\n\nfunction toArray (object) {\n  var result = []\n\n  for (var i = 0; i < object.length; ++i) {\n    result.push(object[i])\n  }\n\n  return result\n}\n\nvar types = [\n  {\n    name: 'primitive',\n\n    is: function (el) {\n      var type = typeof el\n\n      return (type === 'number' || type === 'string' || type === 'boolean')\n    },\n\n    default: 'default',\n\n    merge: {\n      default: function (merger, a, b) {\n        return b\n      }\n    }\n  },\n\n  {\n    name: 'object',\n\n    is: function (el) {\n      return el !== null && (typeof el === 'object')\n    },\n\n    default: 'deep',\n\n    merge: {\n      deep: function (merger, a, b) {\n        var result = {}\n\n        var keys = {\n          a: Object.keys(a),\n          b: Object.keys(b)\n        }\n\n        keys.a.concat(keys.b).forEach(function (key) {\n          result[key] = merger(a[key], b[key])\n        })\n\n        return result\n      }\n    }\n  },\n\n  {\n    name: 'array',\n\n    is: function (el) {\n      return Array.isArray(el)\n    },\n\n    default: 'replace',\n\n    merge: {\n      merge: function (merger, a, b) {\n        var result = []\n\n        for (var i = 0; i < Math.max(a.length, b.length); ++i) {\n          result.push(merger(a[i], b[i]))\n        }\n\n        return result\n      },\n\n      replace: function (merger, a, b) {\n        return nanoclone(b)\n      },\n\n      concat: function (merger, a, b) {\n        return (([]).concat(a)).concat(b)\n      }\n    }\n  }\n]\n\nfunction merge (config) {\n  if (!config) {\n    config = {}\n  }\n\n  config = {\n    strategy: config.strategy || {}\n  }\n\n  function determineType (a, b) {\n    for (var i = types.length - 1; i >= 0; --i) {\n      var type = types[i]\n\n      if (type.is(a) && type.is(b)) {\n        return type\n      } else if (type.is(a) || type.is(b)) {\n        break\n      }\n    }\n\n    return null\n  }\n\n  function merger (a, b) {\n    if (b === void 0) {\n      return nanoclone(a)\n    }\n\n    var type = determineType(a, b)\n\n    if (!type) {\n      return nanoclone(b)\n    }\n\n    var strategy = config.strategy[type.name] || type.default\n\n    return type.merge[strategy](merger, a, b)\n  }\n\n  return function () {\n    var elements = toArray(arguments)\n\n    return elements.reduceRight(function (result, element) {\n      return merger(element, result)\n    })\n  }\n}\n\nfunction wrapper () {\n  var args = toArray(arguments)\n\n  // custom config\n  if (args.length === 1) {\n    return merge(args[0])\n  }\n\n  return merge().apply(null, args)\n}\n\nexport default wrapper\n// module.exports = wrapper\n","import { isObject } from 'is-what'\n// import deepmerge from 'nanomerge'\nimport deepmerge from './nanomerge'\n\nfunction merge (...params) {\n  let l = params.length\n  for (l; l > 0; l--) {\n    const item = params[l - 1]\n    if (!isObject(item)) {\n      console.error('trying to merge a non-object: ', item)\n      return item\n    }\n  }\n  return deepmerge(...params)\n}\n\nexport default merge\n","\nexport default {\n  firestorePath: '',\n    // The path to a collection or doc in firestore. You can use `{userId}` which will be replaced with the user Id.\n  firestoreRefType: '',\n    // `'collection'` or `'doc'`. Depending on your `firestorePath`.\n  moduleName: '',\n    // The module name. Can be nested, eg. `'user/items'`\n  statePropName: '',\n    // The name of the property where the docs or doc will be synced to. If left blank it will be synced on the state of the module. (Please see [Sync directly to module state](#sync-directly-to-module-state) for more info)\n\n  // Related to the 2-way sync:\n  sync: {\n    where: [],\n    orderBy: [],\n    fillables: [],\n    guard: [],\n    // HOOKS for local changes:\n    insertHook: function (updateStore, doc, store) { return updateStore(doc) },\n    patchHook: function (updateStore, doc, store) { return updateStore(doc) },\n    deleteHook: function (updateStore, id, store) { return updateStore(id) },\n  },\n\n  // When items on the server side are changed:\n  serverChange: {\n    defaultValues: {},\n    // HOOKS for changes on SERVER:\n    addedHook: function (updateStore, doc, id, store, source, change) { return updateStore(doc) },\n    modifiedHook: function (updateStore, doc, id, store, source, change) { return updateStore(doc) },\n    removedHook: function (updateStore, doc, id, store, source, change) { return updateStore(doc) },\n  },\n\n  // When items are fetched through `dispatch('module/fetch', filters)`.\n  fetch: {\n    // The max amount of documents to be fetched. Defaults to 50.\n    docLimit: 50,\n  },\n\n  // You can also add custom state/getters/mutations/actions. These will be added to your module.\n  state: {},\n  getters: {},\n  mutations: {},\n  actions: {},\n}\n","\nexport default {\n  _sync: {\n    signedIn: false,\n    patching: false,\n    syncStack: {\n      updates: {},\n      deletions: [],\n      inserts: [],\n      debounceTimer: null\n    },\n    fetched: [],\n    stopPatchingTimeout: null\n  }\n}\n","import { defaultMutations } from 'vuex-easy-access'\nimport { isObject } from 'is-what'\nimport merge from '../utils/deepmerge'\n\nconst mutations = {\n  resetSyncStack (state) {\n    state._sync.syncStack = {\n      updates: {},\n      deletions: [],\n      inserts: [],\n      debounceTimer: null\n    }\n  },\n  INSERT_DOC (state, doc) {\n    if (state._conf.firestoreRefType.toLowerCase() === 'doc') return\n    if (state._conf.statePropName) {\n      this._vm.$set(state[state._conf.statePropName], doc.id, doc)\n    } else {\n      this._vm.$set(state, doc.id, doc)\n    }\n  },\n  PATCH_DOC (state, doc) {\n    // When patching in single 'doc' mode\n    if (state._conf.firestoreRefType.toLowerCase() === 'doc') {\n      // if no target prop is the state\n      if (!state._conf.statePropName) {\n        return Object.keys(doc).forEach(key => {\n          // Merge if exists\n          const newVal = (state[key] === undefined || !isObject(state[key]) || !isObject(doc[key]))\n            ? doc[key]\n            : merge(state[key], doc[key])\n          this._vm.$set(state, key, newVal)\n        })\n      }\n      // state[state._conf.statePropName] will always be an empty object by default\n      state[state._conf.statePropName] = merge(state[state._conf.statePropName], doc)\n      return\n    }\n    // Patching in 'collection' mode\n    // get the doc ref\n    const docRef = (state._conf.statePropName)\n      ? state[state._conf.statePropName][doc.id]\n      : state[doc.id]\n    // Merge if exists\n    const newVal = (docRef === undefined || !isObject(docRef) || !isObject(doc))\n      ? doc\n      : merge(docRef, doc)\n    if (state._conf.statePropName) {\n      this._vm.$set(state[state._conf.statePropName], doc.id, newVal)\n    } else {\n      this._vm.$set(state, doc.id, newVal)\n    }\n  },\n  DELETE_DOC (state, id) {\n    if (state._conf.firestoreRefType.toLowerCase() === 'doc') return\n    if (state._conf.statePropName) {\n      this._vm.$delete(state[state._conf.statePropName], id)\n    } else {\n      this._vm.$delete(state, id)\n    }\n  }\n}\n\nexport default function (userMutations = {}, state) {\n  const vuexEasyMutations = defaultMutations(state)\n  return Object.assign({}, vuexEasyMutations, mutations, userMutations)\n}\n","/**\n * copyObj helper\n *\n * @author     Adam Dorling\n * @contact    https://codepen.io/naito\n */\nexport default function copyObj (obj) {\n  let newObj\n  if (typeof obj != 'object') {\n    return obj\n  }\n  if (!obj) {\n    return obj\n  }\n  if ('[object Object]' !== Object.prototype.toString.call(obj) ||\n    '[object Array]' !== Object.prototype.toString.call(obj)\n  ) {\n    return JSON.parse(JSON.stringify(obj))\n  }\n  // Object is an Array\n  if ('[object Array]' === Object.prototype.toString.call(obj)) {\n    newObj = []\n    for (let i = 0, len = obj.length; i < len; i++) {\n      newObj[i] = copyObj(obj[i])\n    }\n    return newObj\n  }\n  // Object is an Object\n  newObj = {}\n  for (let i in obj) {\n    if (obj.hasOwnProperty(i)) {\n      newObj[i] = copyObj(obj[i])\n    }\n  }\n  return newObj\n}\n","import merge from './deepmerge'\n\n/**\n * Sets default values on an object\n *\n * @param {object} obj on which to set the default values\n * @param {object} defaultValues the default values\n */\nexport default function (obj, defaultValues) {\n  return merge(defaultValues, obj)\n}\n","/**\n * debounce helper\n *\n * @author     Adam Dorling\n * @contact    https://codepen.io/naito\n */\n\n// USAGE:\n// let d = startDebounce(1000)\n// d.done.then(_ => handle())\n// d.refresh() // to refresh\n\nexport default function (ms) {\n  let startTime = Date.now()\n  const done = new Promise((resolve, reject) => {\n    const interval = setInterval(_ => {\n      const now = Date.now()\n      const deltaT = now - startTime\n      if (deltaT >= ms) {\n        clearInterval(interval)\n        resolve(true)\n      }\n    }, 10)\n  })\n  const refresh = () => (startTime = Date.now())\n  return { done, refresh }\n}\n","import { isObject } from 'is-what'\n\nfunction retrievePaths (object, path, result) {\n  if (!isObject(object) || !Object.keys(object).length) {\n    if (!path) return object\n    result[path] = object\n    return result\n  }\n  return Object.keys(object).reduce((carry, key) => {\n    const pathUntilNow = (path)\n      ? path + '.'\n      : ''\n    const newPath = pathUntilNow + key\n    const extra = retrievePaths(object[key], newPath, result)\n    return Object.assign(carry, extra)\n  }, {})\n}\n\nexport default function (object) {\n  const result = {}\n  return retrievePaths(object, null, result)\n}\n","import Firebase from 'firebase/app'\nimport 'firebase/firestore'\nimport 'firebase/auth'\nimport { isArray, isString } from 'is-what'\nimport merge from '../utils/deepmerge'\nimport copyObj from '../utils/copyObj'\nimport setDefaultValues from '../utils/setDefaultValues'\nimport startDebounce from '../utils/debounceHelper'\nimport flattenToPaths from '../utils/objectFlattenToPaths'\n\nconst actions = {\n  patchDoc (\n    {state, getters, commit, dispatch},\n    {id = '', ids = [], doc} = {ids: [], doc: {}}\n  ) {\n    // 0. payload correction (only arrays)\n    if (!isArray(ids)) return console.log('ids needs to be an array')\n    if (id) ids.push(id)\n    if (doc.id) delete doc.id\n\n    // 1. Prepare for patching\n    let syncStackItems = getters.prepareForPatch(ids, doc)\n\n    // 2. Push to syncStack\n    Object.keys(syncStackItems).forEach(id => {\n      const newVal = (!state._sync.syncStack.updates[id])\n        ? syncStackItems[id]\n        : merge(state._sync.syncStack.updates[id],\n                syncStackItems[id])\n      state._sync.syncStack.updates[id] = newVal\n    })\n\n    // 3. Create or refresh debounce\n    return dispatch('handleSyncStackDebounce')\n  },\n  deleteDoc ({state, getters, commit, dispatch},\n  ids = []) {\n    // 0. payload correction (only arrays)\n    if (!isArray(ids)) ids = [ids]\n\n    // 1. Prepare for patching\n    const syncStackIds = getters.prepareForDeletion(ids)\n\n    // 2. Push to syncStack\n    const deletions = state._sync.syncStack.deletions.concat(syncStackIds)\n    state._sync.syncStack.deletions = deletions\n\n    if (!state._sync.syncStack.deletions.length) return\n    // 3. Create or refresh debounce\n    return dispatch('handleSyncStackDebounce')\n  },\n  insertDoc ({state, getters, commit, dispatch},\n  docs = []) {\n    // 0. payload correction (only arrays)\n    if (!isArray(docs)) docs = [docs]\n\n    // 1. Prepare for patching\n    const syncStack = getters.prepareForInsert(docs)\n\n    // 2. Push to syncStack\n    const inserts = state._sync.syncStack.inserts.concat(syncStack)\n    state._sync.syncStack.inserts = inserts\n\n    // 3. Create or refresh debounce\n    return dispatch('handleSyncStackDebounce')\n  },\n  handleSyncStackDebounce ({state, commit, dispatch, getters}) {\n    if (!getters.signedIn) return false\n    if (!state._sync.syncStack.debounceTimer) {\n      const debounceTimer = startDebounce(1000)\n      debounceTimer.done.then(_ => dispatch('batchSync'))\n      state._sync.syncStack.debounceTimer = debounceTimer\n    }\n    state._sync.syncStack.debounceTimer.refresh()\n  },\n  batchSync ({getters, commit, dispatch, state}) {\n    const collectionMode = getters.collectionMode\n    const dbRef = getters.dbRef\n    let batch = Firebase.firestore().batch()\n    let count = 0\n    // Add 'updateds' to batch\n    let updatesOriginal = copyObj(state._sync.syncStack.updates)\n    let updates = Object.keys(updatesOriginal).map(k => {\n      let fields = updatesOriginal[k]\n      return {id: k, fields}\n    })\n    // Check if there are more than 500 batch items already\n    if (updates.length >= 500) {\n      // Batch supports only until 500 items\n      count = 500\n      let updatesOK = updates.slice(0, 500)\n      let updatesLeft = updates.slice(500, -1)\n      // Put back the remaining items over 500\n      state._sync.syncStack.updates = updatesLeft.reduce((carry, item) => {\n        carry[item.id] = item\n        delete item.id\n        return carry\n      }, {})\n      updates = updatesOK\n    } else {\n      state._sync.syncStack.updates = {}\n      count = updates.length\n    }\n    // Add to batch\n    updates.forEach(item => {\n      let id = item.id\n      let docRef = (collectionMode) ? dbRef.doc(id) : dbRef\n      let fields = flattenToPaths(item.fields)\n      console.log('fields → ', fields)\n      batch.update(docRef, fields)\n    })\n    // Add 'deletions' to batch\n    let deletions = copyObj(state._sync.syncStack.deletions)\n    // Check if there are more than 500 batch items already\n    if (count >= 500) {\n      // already at 500 or more, leave items in syncstack, and don't add anything to batch\n      deletions = []\n    } else {\n      // Batch supports only until 500 items\n      let deletionsAmount = 500 - count\n      let deletionsOK = deletions.slice(0, deletionsAmount)\n      let deletionsLeft = deletions.slice(deletionsAmount, -1)\n      // Put back the remaining items over 500\n      state._sync.syncStack.deletions = deletionsLeft\n      count = count + deletionsOK.length\n      // Define the items we'll add below\n      deletions = deletionsOK\n    }\n    // Add to batch\n    deletions.forEach(id => {\n      let docRef = dbRef.doc(id)\n      batch.delete(docRef)\n    })\n    // Add 'inserts' to batch\n    let inserts = copyObj(state._sync.syncStack.inserts)\n    // Check if there are more than 500 batch items already\n    if (count >= 500) {\n      // already at 500 or more, leave items in syncstack, and don't add anything to batch\n      inserts = []\n    } else {\n      // Batch supports only until 500 items\n      let insertsAmount = 500 - count\n      let insertsOK = inserts.slice(0, insertsAmount)\n      let insertsLeft = inserts.slice(insertsAmount, -1)\n      // Put back the remaining items over 500\n      state._sync.syncStack.inserts = insertsLeft\n      count = count + insertsOK.length\n      // Define the items we'll add below\n      inserts = insertsOK\n    }\n    // Add to batch\n    inserts.forEach(item => {\n      let newRef = getters.dbRef.doc(item.id)\n      batch.set(newRef, item)\n    })\n    // Commit the batch:\n    // console.log(`[batchSync] START:\n    //   ${Object.keys(updates).length} updates,\n    //   ${deletions.length} deletions,\n    //   ${inserts.length} inserts`\n    // )\n    dispatch('_startPatching')\n    state._sync.syncStack.debounceTimer = null\n    return new Promise((resolve, reject) => {\n      batch.commit()\n      .then(res => {\n        console.log(`[batchSync] RESOLVED:`, res, `\n          updates: `, Object.keys(updates).length ? updates : {}, `\n          deletions: `, deletions.length ? deletions : [], `\n          inserts: `, inserts.length ? inserts : []\n        )\n        let remainingSyncStack = Object.keys(state._sync.syncStack.updates).length\n          + state._sync.syncStack.deletions.length\n          + state._sync.syncStack.inserts.length\n        if (remainingSyncStack) { dispatch('batchSync') }\n        dispatch('_stopPatching')\n        return resolve()\n        // // Fetch the item if it was added as an Archived item:\n        // if (item.archived) {\n          //   get_ters.dbRef.doc(res.id).get()\n          //   .then(doc => {\n            //     let tempId = doc.data().id\n            //     let id = doc.id\n            //     let item = doc.data()\n            //     item.id = id\n            //     console.log('retrieved Archived new item: ', id, item)\n            //     dispatch('newItemFromServer', {item, tempId})\n            //   })\n            // }\n      }).catch(error => {\n        state._sync.patching = 'error'\n        state._sync.syncStack.debounceTimer = null\n        return reject()\n      })\n    })\n  },\n  fetch (\n    {state, getters, commit, dispatch},\n    {whereFilters = [], orderBy = []} = {whereFilters: [], orderBy: []}\n    // whereFilters: [['archived', '==', true]]\n    // orderBy: ['done_date', 'desc']\n  ) {\n    return new Promise((resolve, reject) => {\n      console.log('[fetch] starting')\n      if (!getters.signedIn) return resolve()\n      const identifier = JSON.stringify({whereFilters, orderBy})\n      const fetched = state._sync.fetched[identifier]\n      // We've never fetched this before:\n      if (!fetched) {\n        let ref = getters.dbRef\n        // apply where filters and orderBy\n        whereFilters.forEach(paramsArr => {\n          ref = ref.where(...paramsArr)\n        })\n        if (orderBy.length) {\n          ref = ref.orderBy(...orderBy)\n        }\n        state._sync.fetched[identifier] = {\n          ref,\n          done: false,\n          retrievedFetchRefs: [],\n          nextFetchRef: null\n        }\n      }\n      const fRequest = state._sync.fetched[identifier]\n      // We're already done fetching everything:\n      if (fRequest.done) {\n        console.log('done fetching')\n        return resolve('fetchedAll')\n      }\n      // attach fetch filters\n      let fRef = state._sync.fetched[identifier].ref\n      if (fRequest.nextFetchRef) {\n        // get next ref if saved in state\n        fRef = state._sync.fetched[identifier].nextFetchRef\n      }\n      fRef = fRef.limit(state._conf.fetch.docLimit)\n      // Stop if all records already fetched\n      if (fRequest.retrievedFetchRefs.includes(fRef)) {\n        console.log('Already retrieved this part.')\n        return resolve()\n      }\n      // make fetch request\n      fRef.get()\n      .then(querySnapshot => {\n        const docs = querySnapshot.docs\n        if (docs.length === 0) {\n          state._sync.fetched[identifier].done = true\n          resolve('fetchedAll')\n\n          return\n        }\n        if (docs.length < state._conf.fetch.docLimit) {\n          state._sync.fetched[identifier].done = true\n        }\n        state._sync.fetched[identifier].retrievedFetchRefs.push(fetchRef)\n        // Get the last visible document\n        resolve(querySnapshot)\n        const lastVisible = docs[docs.length - 1]\n        // get the next records.\n        const next = fRef.startAfter(lastVisible)\n        state._sync.fetched[identifier].nextFetchRef = next\n      }).catch(error => {\n        console.log(error)\n        return reject(error)\n      })\n    })\n  },\n  serverUpdate ({commit}, {change, id, doc = {}}) {\n    doc.id = id\n    switch (change) {\n      case 'added':\n        commit('INSERT_DOC', doc)\n        break\n      case 'removed':\n        commit('DELETE_DOC', id)\n        break\n      default:\n        commit('PATCH_DOC', doc)\n        break\n    }\n  },\n  openDBChannel ({getters, state, commit, dispatch}) {\n    const store = this\n    if (Firebase.auth().currentUser) state._sync.signedIn = true\n    const collectionMode = getters.collectionMode\n    let dbRef = getters.dbRef\n    // apply where filters and orderBy\n    if (state._conf.firestoreRefType.toLowerCase() !== 'doc') {\n      state._conf.sync.where.forEach(paramsArr => {\n        dbRef = dbRef.where(...paramsArr)\n      })\n      if (state._conf.sync.orderBy.length) {\n        dbRef = dbRef.orderBy(...state._conf.sync.orderBy)\n      }\n    }\n    // define handleDoc()\n    function handleDoc (change, id, doc, source) {\n      change = (!change) ? 'modified' : change.type\n      // define storeUpdateFn()\n      function storeUpdateFn (_doc) {\n        return dispatch('serverUpdate', {change, id, doc: _doc})\n      }\n      // get user set sync hook function\n      const syncHookFn = state._conf.serverChange[change + 'Hook']\n      if (syncHookFn) {\n        syncHookFn(storeUpdateFn, doc, id, store, source, change)\n      } else {\n        storeUpdateFn(doc)\n      }\n    }\n    // make a promise\n    return new Promise ((resolve, reject) => {\n      dbRef\n      .onSnapshot(querySnapshot => {\n        let source = querySnapshot.metadata.hasPendingWrites ? 'local' : 'server'\n        if (!collectionMode) {\n          const doc = setDefaultValues(querySnapshot.data(), state._conf.serverChange.defaultValues)\n          if (source === 'local') return resolve()\n          handleDoc(null, null, doc, source)\n          return resolve()\n        }\n        querySnapshot.docChanges().forEach(change => {\n          // Don't do anything for local modifications & removals\n          if (source === 'local' &&\n            (change.type === 'modified' || change.type === 'removed')\n          ) {\n            return resolve()\n          }\n          const id = change.doc.id\n          const doc = (change.type === 'added')\n            ? setDefaultValues(change.doc.data(), state._conf.serverChange.defaultValues)\n            : change.doc.data()\n          handleDoc(change, id, doc, source)\n          return resolve()\n        })\n      }, error => {\n        state._sync.patching = 'error'\n        return reject(error)\n      })\n    })\n  },\n  set ({commit, dispatch, getters, state}, doc) {\n    if (!doc) return\n    if (!getters.collectionMode) {\n      return dispatch('patch', doc)\n    }\n    if (\n      !doc.id ||\n      (!state._conf.statePropName && !state[doc.id]) ||\n      (state._conf.statePropName && !state[state._conf.statePropName][doc.id])\n    ) {\n      return dispatch('insert', doc)\n    }\n    return dispatch('patch', doc)\n  },\n  insert ({state, getters, commit, dispatch}, doc) {\n    const store = this\n    if (!doc) return\n    if (!doc.id) doc.id = getters.dbRef.doc().id\n    // define the store update\n    function storeUpdateFn (_doc) {\n      commit('INSERT_DOC', _doc)\n      return dispatch('insertDoc', _doc)\n    }\n    // check for hooks\n    if (state._conf.sync.insertHook) {\n      return state._conf.sync.insertHook(storeUpdateFn, doc, store)\n    }\n    return storeUpdateFn(doc)\n  },\n  patch ({state, getters, commit, dispatch}, doc) {\n    const store = this\n    if (!doc) return\n    if (!doc.id && getters.collectionMode) return\n    // define the store update\n    function storeUpdateFn (_doc) {\n      commit('PATCH_DOC', _doc)\n      return dispatch('patchDoc', {id: _doc.id, doc: _doc})\n    }\n    // check for hooks\n    if (state._conf.sync.patchHook) {\n      return state._conf.sync.patchHook(storeUpdateFn, doc, store)\n    }\n    return storeUpdateFn(doc)\n  },\n  patchBatch (\n    {state, getters, commit, dispatch},\n    {doc, ids = []}\n  ) {\n    const store = this\n    if (!doc) return\n    // define the store update\n    function storeUpdateFn (_doc) {\n      commit('PATCH_DOC', _doc)\n      return dispatch('patchDoc', {ids, doc: _doc})\n    }\n    // check for hooks\n    if (state._conf.sync.patchHook) {\n      return state._conf.sync.patchHook(storeUpdateFn, doc, store)\n    }\n    return storeUpdateFn(doc)\n  },\n  delete ({state, getters, commit, dispatch}, id) {\n    const store = this\n    // define the store update\n    function storeUpdateFn (_id) {\n      commit('DELETE_DOC', _id)\n      return dispatch('deleteDoc', _id)\n    }\n    // check for hooks\n    if (state._conf.sync.deleteHook) {\n      return state._conf.sync.deleteHook(storeUpdateFn, id, store)\n    }\n    return storeUpdateFn(id)\n  },\n  _stopPatching ({state, commit}) {\n    if (state._sync.stopPatchingTimeout) { clearTimeout(state._sync.stopPatchingTimeout) }\n    state._sync.stopPatchingTimeout = setTimeout(_ => { state._sync.patching = false }, 300)\n  },\n  _startPatching ({state, commit}) {\n    if (state._sync.stopPatchingTimeout) { clearTimeout(state._sync.stopPatchingTimeout) }\n    state._sync.patching = true\n  }\n}\n\nexport default function (userActions = {}) {\n  return Object.assign({}, actions, userActions)\n}\n","\nimport { isObject } from 'is-what'\n/**\n * Checks all props of an object and deletes guarded and non-fillables.\n *\n * @param {object}  obj       the target object to check\n * @param {array}   fillables an array of strings, with the props which should be allowed on returned object\n * @param {array}   guard     an array of strings, with the props which should NOT be allowed on returned object\n *\n * @returns {object} the cleaned object after deleting guard and non-fillables\n */\nexport default function (obj, fillables = [], guard = []) {\n  if (!isObject(obj)) return obj\n  if (fillables.length) {\n    Object.keys(obj).forEach(key => {\n      if (!fillables.includes(key)) {\n        delete obj[key]\n      }\n    })\n  }\n  guard.forEach(key => {\n    delete obj[key]\n  })\n  return obj\n}\n","import Firebase from 'firebase/app'\nimport 'firebase/firestore'\nimport 'firebase/auth'\nimport copyObj from '../utils/copyObj'\nimport { getDeepRef } from 'vuex-easy-access'\nimport checkFillables from '../utils/checkFillables'\n\nconst getters = {\n  signedIn: (state, getters, rootState, rootGetters) => {\n    return state._sync.signedIn\n  },\n  dbRef: (state, getters, rootState, rootGetters) => {\n    if (!getters.signedIn) return false\n    if (!Firebase.auth().currentUser) return false\n    const userId = Firebase.auth().currentUser.uid\n    const path = state._conf.firestorePath.replace('{userId}', userId)\n    return (state._conf.firestoreRefType.toLowerCase() === 'collection')\n      ? Firebase.firestore().collection(path)\n      : Firebase.firestore().doc(path)\n  },\n  storeRef: (state, getters, rootState) => {\n    const path = (state._conf.statePropName)\n      ? `${state._conf.moduleName}/${state._conf.statePropName}`\n      : state._conf.moduleName\n    return getDeepRef(rootState, path)\n  },\n  collectionMode: (state, getters, rootState) => {\n    return (state._conf.firestoreRefType.toLowerCase() === 'collection')\n  },\n  prepareForPatch: (state, getters, rootState, rootGetters) =>\n  (ids = [], doc = {}) => {\n    // get relevant data from the storeRef\n    const collectionMode = getters.collectionMode\n    if (!collectionMode) ids.push('singleDoc')\n    // returns {object} -> {id: data}\n    return ids.reduce((carry, id) => {\n      let patchData = {}\n      // retrieve full object\n      if (!Object.keys(doc).length) {\n        patchData = (collectionMode)\n          ? getters.storeRef[id]\n          : getters.storeRef\n      } else {\n        patchData = doc\n      }\n      patchData = copyObj(patchData)\n      patchData = checkFillables(patchData, state._conf.sync.fillables, state._conf.sync.guard)\n      patchData.updated_at = Firebase.firestore.FieldValue.serverTimestamp()\n      carry[id] = patchData\n      return carry\n    }, {})\n  },\n  prepareForDeletion: (state, getters, rootState, rootGetters) =>\n  (ids = []) => {\n    return ids.reduce((carry, id) => {\n      carry.push(id)\n      return carry\n    }, [])\n  },\n  prepareForInsert: (state, getters, rootState, rootGetters) =>\n  (items = []) => {\n    items = copyObj(items)\n    return items.reduce((carry, item) => {\n      item = checkFillables(item, state._conf.sync.fillables, state._conf.sync.guard)\n      item.created_at = Firebase.firestore.FieldValue.serverTimestamp()\n      item.created_by = rootGetters['user/id']\n      carry.push(item)\n      return carry\n    }, [])\n  }\n}\n\nexport default function (userGetters = {}) {\n  return Object.assign({}, getters, userGetters)\n}\n","\nexport default function errorCheck (config) {\n  let reqProps = ['firestorePath', 'moduleName']\n  reqProps.forEach(prop => {\n    if (!config[prop]) {\n      console.error(`Missing ${prop} from your config!`)\n      return false\n    }\n  })\n  if (/(\\.|\\/)/.test(config.statePropName)) {\n    console.error(`statePropName must only include letters from [a-z]`)\n    return false\n  }\n  if (/\\./.test(config.moduleName)) {\n    console.error(`moduleName must only include letters from [a-z] and forward slashes '/'`)\n    return false\n  }\n  return true\n}\n","import merge from '../utils/deepmerge'\n// store\nimport defaultConfig from './defaultConfig'\nimport initialState from './state'\nimport iniMutations from './mutations'\nimport iniActions from './actions'\nimport iniGetters from './getters'\nimport errorCheck from './errorCheck'\n\n/**\n * A function that returns a vuex module object with seamless 2-way sync for firestore.\n *\n * @param {object} userConfig Takes a config object as per ...\n * @returns {object} the module ready to be included in your vuex store\n */\nexport default function (userConfig) {\n  const conf = merge(defaultConfig, userConfig)\n  if (!errorCheck(conf)) return\n  const userState = conf.state\n  const userMutations = conf.mutations\n  const userActions = conf.actions\n  const userGetters = conf.getters\n  delete conf.state\n  delete conf.mutations\n  delete conf.actions\n  delete conf.getters\n\n  const docContainer = {}\n  if (conf.statePropName) docContainer[conf.statePropName] = {}\n  const state = merge(initialState, userState, docContainer, {_conf: conf})\n  return {\n    namespaced: true,\n    state,\n    mutations: iniMutations(userMutations, merge(initialState, userState)),\n    actions: iniActions(userActions),\n    getters: iniGetters(userGetters)\n  }\n}\n","import Firebase from 'firebase/app'\nimport 'firebase/auth'\nimport { getKeysFromPath } from 'vuex-easy-access'\nimport { isArray } from 'is-what'\nimport iniModule from './module/index'\n\nexport default function createEasyFirestore (userConfig) {\n  return store => {\n    // Get an array of config files\n    if (!isArray(userConfig)) userConfig = [userConfig]\n    // Create a module for each config file\n    userConfig.forEach(config => {\n      const moduleName = getKeysFromPath(config.moduleName)\n      store.registerModule(moduleName, iniModule(config))\n    })\n    store.setDoc = (path, payload) => {\n      return store.dispatch(path + '/setDoc', payload)\n    }\n    store.insert = (path, payload) => {\n      return store.dispatch(path + '/insert', payload)\n    }\n    store.patch = (path, payload) => {\n      return store.dispatch(path + '/patch', payload)\n    }\n    store.patchBatch = (path, payload) => {\n      return store.dispatch(path + '/patchBatch', payload)\n    }\n    store.delete = (path, payload) => {\n      return store.dispatch(path + '/delete', payload)\n    }\n  }\n}\n"],"names":["nanoclone","require","default","toArray","object","result","i","length","push","types","name","is","el","type","merge","merger","a","b","deep","keys","Object","concat","forEach","key","Array","isArray","Math","max","replace","config","strategy","determineType","elements","arguments","reduceRight","element","wrapper","args","apply","l","item","isObject","console","error","deepmerge","firestorePath","firestoreRefType","moduleName","statePropName","sync","where","orderBy","fillables","guard","insertHook","updateStore","doc","store","patchHook","deleteHook","id","serverChange","defaultValues","addedHook","source","change","modifiedHook","removedHook","fetch","docLimit","state","getters","mutations","actions","_sync","signedIn","patching","syncStack","updates","deletions","inserts","debounceTimer","fetched","stopPatchingTimeout","resetSyncStack","INSERT_DOC","_conf","toLowerCase","_vm","$set","PATCH_DOC","newVal","undefined","docRef","DELETE_DOC","$delete","userMutations","vuexEasyMutations","defaultMutations","assign","copyObj","obj","newObj","prototype","toString","call","JSON","parse","stringify","len","hasOwnProperty","ms","startTime","Date","now","done","Promise","resolve","reject","interval","setInterval","deltaT","clearInterval","refresh","retrievePaths","path","reduce","carry","pathUntilNow","newPath","extra","patchDoc","commit","dispatch","ids","log","syncStackItems","prepareForPatch","deleteDoc","syncStackIds","prepareForDeletion","insertDoc","docs","prepareForInsert","handleSyncStackDebounce","startDebounce","then","batchSync","collectionMode","dbRef","batch","Firebase","firestore","count","updatesOriginal","map","fields","k","updatesOK","slice","updatesLeft","flattenToPaths","update","deletionsAmount","deletionsOK","deletionsLeft","delete","insertsAmount","insertsOK","insertsLeft","newRef","set","res","remainingSyncStack","catch","whereFilters","identifier","ref","paramsArr","retrievedFetchRefs","nextFetchRef","fRequest","fRef","limit","includes","get","querySnapshot","fetchRef","lastVisible","next","startAfter","serverUpdate","openDBChannel","auth","currentUser","handleDoc","storeUpdateFn","_doc","syncHookFn","onSnapshot","metadata","hasPendingWrites","setDefaultValues","data","docChanges","insert","patch","patchBatch","_id","_stopPatching","clearTimeout","setTimeout","_startPatching","userActions","rootState","rootGetters","userId","uid","collection","storeRef","getDeepRef","patchData","checkFillables","updated_at","FieldValue","serverTimestamp","items","created_at","created_by","userGetters","errorCheck","reqProps","prop","test","userConfig","conf","defaultConfig","userState","docContainer","initialState","namespaced","iniMutations","iniActions","iniGetters","createEasyFirestore","getKeysFromPath","registerModule","iniModule","setDoc","payload"],"mappings":"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"}